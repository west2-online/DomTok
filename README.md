<div align="center">
  <h1 style="display: inline-block; vertical-align: middle;">DomTok</h1>
</div>

<div align="center">
  <a href="#overview">English</a> | <a href="docs/README.zh.md">简体中文</a>
</div>

## Overview
DomTok is a simple Douyin e-commerce backend based on HTTP and RPC protocols, using the clean architecture and a distributed architecture. It makes use of Kitex, Hertz, Mysql, Redis, Etcd, Kafka, Elasticsearch, Kibana, Filebeat, Jaeger, Rocketmq, Otel-Collector, several-exporter, Prometheus, VictoriaMetrics, Cadvisor, and Grafana.

## Features
- Cloud-native: Designed with a native Golang distributed architecture, based on ByteDance's best practices.
- High performance: Supports asynchronous RPC, non-blocking I/O, message queues, and Just-In-Time (JIT) compilation.
- Scalability: Modular and layered structure design based on the clean architecture, with clear and readable code, reducing the development difficulty.
- Observability: Distributed tracing based on OpenTelemetry, Prometheus monitoring, Elasticsearch log collection, and Grafana visualization.
- Code quality: CI/CD process based on Github Actions, rich unit tests, high code quality, and high security.
- AI functionality: Implement text input to call interfaces through **Function Calling** based on ByteDance's Eino framework and LLM.
- DevOps: Abundant scripts and tools reduce unnecessary manual operations and simplify the usage and deployment processes.

## Architecture
![Architecture](./docs/img/Architecture.png)

### Coding architecture
The project has been layered designed based on the clean architecture, as shown in the following figure:
![Coding-architecture.png](./docs/img/Coding-architecture.png)

## Project structure

### Overall
```text
.
├── LICENSE
├── Makefile                # Some make commands
├── README.md     
├── app                     # Implementations of various microservices
├── cmd                     # Startup entrances of various microservices
├── config                  # Configuration files
├── deploy                  # Deployment files
├── docker                  # Related to docker
├── go.mod
├── go.sum
├── hack                    # Tools for automated development, building, and deployment tasks
├── idl                     # Interface definitions
├── kitex_gen               # Code generated by Kitex
└── pkg
    ├── base                # General basic services
    │   ├── client    	    # Clients of corresponding components (e.g., redis, mysql)
    │   └── context         # Custom context for passing data between services
    ├── constants           # Store constants
    ├── errno               # Custom errors
    ├── kafka               # Some encapsulations of kafka functions
    ├── logger              # Logging system
    ├── middleware          # Middleware
    ├── upyun               # Some encapsulations of Upyun
    └── utils               # Some utility functions
```

### Gateway/Api module
```text
./app/gateway
├── handler                 # Handlers for processing requests
├── model                   # Models generated by hz
├── mw                      # Middleware
├── pack                    # Encapsulate requests and responses
├── router                  # Routing
└── rpc                     # Send RPC requests
```

### Microservice (order module)
```text
./app/order
├── controllers       # Implementation layer of the rpcService interface, responsible for converting requests and responses
├── domain            # Domain layer in the clean architecture
│   ├── model         # Define structs used within the module
│   ├── repository    # Define interfaces used within the module
│   └── service       # Implement reusable core business logic
├── infrastructure    # Interface layer in the clean architecture, named infrastructure to avoid ambiguity
│   ├── locker        # Specific implementation of the locker interface in domain-repository
│   ├── mq            # Specific implementation of the mq interface in domain-repository
│   ├── mysql         # Specific implementation of the db interface in domain-repository
│   ├── redis         # Specific implementation of the cache interface in domain-repository
│   └── rpc           # Specific implementation of the rpc interface in domain-repository
└── usecase
```

## Test
- Unit tests: This project uses `github/bytedance/mockey` and `github.com/smartystreets/goconvey/convey` for rich unit tests. You can use `make test` to run the tests.
- Unit tests with environment: In addition to unit tests that require mocking, we also use environment variables to control the test environment, allowing some of our unit tests to run in a real environment. You can use `make with-env-test` to start the environment and run these tests.
- API interface tests: We use **Apifox** for fully automated testing of interfaces to ensure the interfaces. You can view our test cases [here]().

## Quick start and deploy
This project has greatly simplified the process through scripts. You can refer to the [deployment document](docs/deploy.md) to quickly start and deploy the project.

## Visualization Example
Next, we will show the visualization effects achieved through tools such as `Prometheus`, `Grafana`, `VictoriaMetrics`, `Jaeger`, `Filebeat`, `Otel-Collector`, etc. (Only part of the data is shown due to the large amount of data.)

### Docker
![docker.png](docs/img/metrics/docker.png)

### Go Programs（total）
![go.png](docs/img/metrics/go.png)

### Mysql
![mysql.png](docs/img/metrics/mysql.png)

### Redis
![redis.png](docs/img/metrics/redis.png)

### System
![system.png](docs/img/metrics/system.png)

### Jaeger
![system.png](docs/img/metrics/jaeger.png)


## Contributors

<a href="https://github.com/west2-online/DomTok/graphs/contributors">
  <img src="https://contrib.rocks/image?repo=west2-online/DomTok" />
</a>
